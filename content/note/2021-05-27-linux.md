---
title: "Linux Cheat Sheet"
date: 2021-05-01T09:59:35+08:00
categories:
  - tech
---
## General
* tar directory without compressing

## Bash
format date time
```bash
date=$(date '+%Y%m%d_%H%M%S')
```

get the directory in which a Bash script is located
```bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
```

package directory without compress
```bash
$ tar -cvf myfolder.tar myfolder
```

find .go file except the vendor directory
```bash
$ find . -path ./vendor -prune -false -o -name '*.go'`
```

list sub-directories by size
```bash
du -h --max-depth=1 | sort -h
```

decompress
```bash
# decompress filename.tar.xx
tar xvf archive.tar.xz
# GNU tar recognizes the format by itself!
```

## Git
```bash
# uncommitted changes since the last commit.
git diff

# diff staged changes.
git diff --cached

git diff HEAD
```

checkout github pr
```bash
# using gh
# https://github.com/mobile-shell/mosh/pull/1104

$ git clone https://github.com/mobile-shell/mosh
&& cd mosh
$ gh pr checkout 1104
$ ./autogen.sh && ./configure && make && sudo make install

# or, merge it manually
$ git remote add mgulick https://github.com/mgulick/mosh.git
$ git fetch mgulick osc-52-clipboard-types
```
## Networking
### one line http file server in Python
```bash
$ python -m SimpleHTTPServer 8000
```

### lsof
```bash
$ lsof -nP -i4TCP:1080 -sTCP:LISTEN
$ lsof -nP -i4TCP:1080 -sTCP:ESTABLISHED
$ lsof -iTCP -sTCP:LISTEN -n -P
# -a means AND in lsof
$ lsof -itcp -a -p "1280595"
```

### tcpdump
```bash
$ sudo tcpdump -i all host 127.0.0.1 and port 1080 -w cap1.pcap
```

### ip
```bash
# Bring wlan0 online
ip link set wlan0 up

# Bring wlan0 offline
ip link set wlan0 down
```

### iperf
```bash
# server
iperf3 -s

# client
iperf3 -c 192.168.2.1
```
### ssh tunnel
```bash
# listen on the remote side, and forward connection to the local side
ssh -p 22 -qngfNTR 8082:localhost:8080 dev2
```

## File system

mount local image file to file system

```bash
$ mount -o loop,offset=63963136 RetroPie_2017_8_29_rom.img /mnt/2

# find offset if multiple partition exists.
$ parted RetroPie_2017_8_29_rom.img
Disk /home/pi/RetroPie_2017_8_29_rom.img: 3276MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      4194kB  64.0MB  59.8MB  primary  fat16        lba
 2      64.0MB  3275MB  3211MB  primary  ext4

(parted) u
Unit?  [compact]? B
(parted) print
Model:  (file)
Disk /home/pi/RetroPie_2017_8_29_rom.img: 3275999744B
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start      End          Size         Type     File system  Flags
 1      4194304B   63963135B    59768832B    primary  fat16        lba
 2      63963136B  3274702847B  3210739712B  primary  ext4
```

## Package
### install with dependency
```
yum install ./percona-toolkit-3.3.1-1.el7.x86_64.rpm
```
### install libs

library missing error when compiling mosh

```bash
checking for protobuf... no
configure: error: Package requirements (protobuf) were not met:

No package 'protobuf' found

Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.

Alternatively, you may set the environment variables protobuf_CFLAGS
and protobuf_LIBS to avoid the need to call pkg-config.
See the pkg-config man page for more details.
```

search and install

```
sudo apt search protobuf
sudo apt install libprotobuf-dev
```
